# Cosmic Harmonics - Script Documentation

This document provides an overview of the C# scripts created for the "Cosmic Harmonics" project, detailing their purpose, public members, and key methods.

**Last Updated:** (2025-06-02) <--- _Set this to today's date_
**Current Phase:** Phase 1: Prototyping (MVP) - Stability Zone Implemented

---

## Table of Contents

1.  **Core Systems (`Assets/_Project/Scripts/Core/Input/`)**
    -   `InputManager.cs`
    -   `PlayerControls.cs` (Auto-generated by Input System)
2.  **Gameplay Systems (`Assets/_Project/Scripts/Gameplay/`)**
    -   `SeedController.cs`
    -   `GravityWell_Star.cs`
    -   `StabilityZone.cs`

---

## 1. Core Systems

### 1.1. `InputManager.cs`

**File Path:** `Assets/_Project/Scripts/Core/Input/InputManager.cs`

**Purpose:**
Handles player input for flicking actions using Unity's new Input System. It detects mouse click-drag-release gestures, converts screen coordinates to world coordinates, and provides data about the flick (start position, end position, vector). It also currently holds temporary logic to directly launch a test seed.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** None (but it references `Camera.main`).

**Public Members:**

-   **`public static InputManager Instance { get; private set; }`**
    -   A static property for implementing the Singleton pattern, allowing global access to the `InputManager` instance.
-   **`public SeedController testSeedToLaunch;`**
    -   **TEMPORARY:** A public reference to a `SeedController` instance. This is assigned in the Inspector and used for directly launching a seed for prototyping purposes. This responsibility will likely move to a `LevelManager` or `SeedSpawner` later.
-   **`public Vector2 FlickStartPosition { get; private set; }`**
    -   The world-space coordinates where the flick gesture started (mouse button pressed).
-   **`public Vector2 FlickEndPosition { get; private set; }`**
    -   The world-space coordinates where the flick gesture ended (mouse button released).
-   **`public bool IsFlicking { get; private set; }`**
    -   A boolean flag indicating if a flick gesture is currently in progress (mouse button is held down after an initial press).
-   **`public event System.Action<Vector2> OnFlickStart;`**
    -   An event fired when a flick gesture begins.
    -   Parameter: `Vector2` - The world-space position where the flick started.
-   **`public event System.Action<Vector2, Vector2> OnFlickEnd;`**
    -   An event fired when a flick gesture completes.
    -   Parameters:
        -   `Vector2` - The world-space position where the flick started.
        -   `Vector2` - The world-space position where the flick ended.

**Key Methods:**

-   **`private void Awake()`**
    -   Implements the Singleton pattern logic.
    -   Initializes `_playerControls = new PlayerControls();` (the auto-generated input actions class).
    -   Caches `_mainCamera = Camera.main;`.
    -   Includes error handling for `_playerControls` initialization and `Camera.main` availability.
-   **`private void OnEnable()`**
    -   Enables the `Gameplay` action map from `_playerControls`.
    -   Subscribes `OnFlickPressStarted` and `OnFlickPressCanceled` methods to the `started` and `canceled` events of the `FlickPress` input action.
    -   Includes error handling.
-   **`private void OnDisable()`**
    -   Unsubscribes from the `FlickPress` input action events.
    -   Disables the `Gameplay` action map.
-   **`private void OnFlickPressStarted(InputAction.CallbackContext context)`**
    -   Callback method executed when the `FlickPress` action starts (e.g., left mouse button down).
    -   Sets `IsFlicking = true`.
    -   Records `FlickStartPosition` using `GetPointerPositionInWorld()`.
    -   Invokes the `OnFlickStart` event.
-   **`private void OnFlickPressCanceled(InputAction.CallbackContext context)`**
    -   Callback method executed when the `FlickPress` action is canceled (e.g., left mouse button released).
    -   Sets `IsFlicking = false`.
    -   Records `FlickEndPosition`.
    -   Invokes the `OnFlickEnd` event.
    -   Calculates the `flickVector`.
    -   **TEMPORARY:** Contains logic to find `testSeedToLaunch`, set its position, reset it, and call its `Launch()` method.
-   **`public Vector2 GetPointerPositionInWorld()`**
    -   Reads the current pointer (mouse) screen position from `_playerControls.Gameplay.PointerPosition`.
    -   Converts the screen position to world coordinates using `_mainCamera.ScreenToWorldPoint()`.
    -   Returns a `Vector2` representing the pointer's position in the 2D game world (Z is effectively discarded).
    -   Includes error handling for `_mainCamera` and `_playerControls` being null.

**Dependencies:**

-   `PlayerControls.cs` (auto-generated input class).
-   `SeedController.cs` (for the temporary `testSeedToLaunch` field).
-   A `Camera` tagged "MainCamera" in the scene.

---

### 1.2. `PlayerControls.cs` (Auto-generated)

**File Path:** `Assets/_Project/Scripts/Core/Input/PlayerControls.cs`

**Purpose:**
This script is auto-generated by Unity's Input System based on the `PlayerControls.inputactions` asset. It provides a C# interface to the defined Action Maps, Actions, and Bindings. **This script should NOT be manually edited**, as changes will be overwritten when the `.inputactions` asset is modified or reimported.

**Key Auto-generated Content:**
_(Content remains largely the same as previously documented, focusing on Gameplay Action Map with FlickPress and PointerPosition actions)._

---

## 2. Gameplay Systems

### 2.1. `SeedController.cs`

**File Path:** `Assets/_Project/Scripts/Gameplay/SeedController.cs`

**Purpose:**
Manages the behavior of an individual "celestial seed." This includes its physics interactions, launch mechanics, state (e.g., flying, stabilizing, stable), and interaction with stability zones.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** `Rigidbody2D`, `CircleCollider2D` (enforced by `[RequireComponent]` attributes). A `SpriteRenderer` is also expected for visual feedback.

**Public Members:**

-   **`public float launchForceMultiplier = 10f;`**
    -   A multiplier applied to the flick vector to determine the final launch force.
-   **`public float stabilizationTimeRequired = 2f;`**
    -   The duration (in seconds) a seed must remain quasi-stationary within a stability zone to become stable.
-   **`public float quasiStationaryVelocityThreshold = 0.1f;`**
    -   The maximum velocity magnitude (speed) for a seed to be considered "quasi-stationary" and eligible for stabilization.
-   **`public Color flyingColor = Color.white;`**
    -   Color of the seed when it's actively moving or not in a special state.
-   **`public Color stabilizingColor = Color.yellow;`**
    -   Color of the seed when it's in a stability zone and in the process of stabilizing.
-   **`public Color stableColor = Color.green;`**
    -   Color of the seed once it has successfully stabilized.

**Key Methods:**

-   **`private void Awake()`**
    -   Caches attached `Rigidbody2D` and `SpriteRenderer` components. Sets initial color.
-   **`private void Update()`**
    -   Handles the core stabilization logic if the seed is launched, not yet stable, and inside a stability zone.
    -   Checks `_rb.linearVelocity.magnitude` against `quasiStationaryVelocityThreshold`.
    -   If quasi-stationary:
        -   Sets `_isStabilizing = true` and updates color.
        -   Increments `_stabilizationTimer`.
        -   If `_stabilizationTimer` exceeds `stabilizationTimeRequired`, sets `_isStable = true`, updates color, and logs stability.
    -   If moving too fast while previously stabilizing, or if it exits the zone while stabilizing: resets stabilization progress and color.
-   **`public void Launch(Vector2 flickVector)`**
    -   Applies a launch force to the seed if it is not already stable.
    -   Prevents re-launching an already launched seed unless it's reset first.
    -   Ensures `_rb.bodyType` is `Dynamic`.
    -   Applies force using `_rb.AddForce(flickVector * launchForceMultiplier, ForceMode2D.Impulse)`.
    -   Sets `_isLaunched = true` and updates color to `flyingColor`.
-   **`public void EnterStabilityZone(StabilityZone zone)`**
    -   Called by a `StabilityZone` when the seed enters its trigger.
    -   Sets `_isInStabilityZone = true`, stores `_currentStabilityZone`, and resets stabilization progress (`_isStabilizing`, `_stabilizationTimer`).
-   **`public void ExitStabilityZone(StabilityZone zone)`**
    -   Called by a `StabilityZone` when the seed exits its trigger.
    -   Resets `_isInStabilityZone`, `_currentStabilityZone`, `_isStabilizing`, `_stabilizationTimer`.
    -   Reverts color to `flyingColor` if the seed was not stable.
-   **`public void ResetSeed(Vector2 startPosition)`**
    -   Resets the seed to an initial state at the given `startPosition`.
    -   Sets `_rb.linearVelocity` and `_rb.angularVelocity` to zero.
    -   Resets all state flags: `_isLaunched`, `_isStabilizing`, `_isStable`, `_isInStabilityZone`.
    -   Clears `_currentStabilityZone` and `_stabilizationTimer`.
    -   Sets color to `flyingColor`.
-   **`private void SetColor(Color newColor)`**
    -   Helper method to change the `SpriteRenderer`'s color.

**Dependencies:**

-   `InputManager.cs` (or another system) to call `Launch()` and `ResetSeed()`.
-   `StabilityZone.cs` to call `EnterStabilityZone()` and `ExitStabilityZone()`.
-   A `SpriteRenderer` component on the same GameObject for visual feedback.

---

### 2.2. `GravityWell_Star.cs`

**File Path:** `Assets/_Project/Scripts/Gameplay/GravityWell_Star.cs`

**Purpose:**
Defines the behavior of a fixed "Star" gravity well. It exerts a radial gravitational pull on any GameObjects tagged "Seed" that enter its defined effect radius.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** `CircleCollider2D` (enforced by `[RequireComponent]` attribute). This collider should be set as a Trigger.

**Public Members:**

-   **`public float gravityStrength = 50f;`**
    -   The magnitude of the gravitational force applied by the star.
-   **`public float effectRadius = 5f;`**
    -   The radius within which the star's gravity affects seeds.

**Key Methods:**
_(Content remains the same as previously documented, focusing on OnTriggerEnter/Exit2D and FixedUpdate for applying gravitational force)._

**Dependencies:**

-   `SeedController.cs` (specifically, GameObjects with this script, tagged "Seed", and having a `Rigidbody2D`).

---

### 2.3. `StabilityZone.cs`

**File Path:** `Assets/_Project/Scripts/Gameplay/StabilityZone.cs`

**Purpose:**
Defines a zone where "Seeds" can attempt to stabilize. It detects seeds entering and exiting its trigger volume and notifies the `SeedController` accordingly. It also provides visual feedback for its active state.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** A 2D trigger collider (e.g., `BoxCollider2D` or `CircleCollider2D` with `Is Trigger` enabled). A `SpriteRenderer` is also expected for visual feedback.

**Public Members (Serialized Fields):**

-   **`[SerializeField] private Color activeColor`**
    -   Color used for the zone's sprite when a seed is inside. Default: Light green, semi-transparent.
-   **`[SerializeField] private Color inactiveColor`**
    -   Color used for the zone's sprite when no seed is inside or it's initialized. Default: Light blue, more transparent.

**Key Methods:**

-   **`private void Awake()`**
    -   Caches the `SpriteRenderer` component.
    -   Sets the initial color of the zone to `inactiveColor`.
-   **`private void OnTriggerEnter2D(Collider2D other)`**
    -   Called when another collider enters this GameObject's trigger.
    -   Checks if `other.CompareTag("Seed")`.
    -   If it's a seed, gets its `SeedController` component.
    -   Calls `seed.EnterStabilityZone(this)` on the `SeedController`.
    -   Calls `SetZoneColor(true)` to change the zone's visual appearance.
    -   Logs the entry event.
-   **`private void OnTriggerExit2D(Collider2D other)`**
    -   Called when another collider exits this GameObject's trigger.
    -   Checks if `other.CompareTag("Seed")`.
    -   If it's a seed, gets its `SeedController` component.
    -   Calls `seed.ExitStabilityZone(this)` on the `SeedController`.
    -   Calls `SetZoneColor(false)` to revert the zone's visual appearance.
    -   Logs the exit event.
-   **`private void SetZoneColor(bool isActive)`**
    -   Helper method to change the `_spriteRenderer.color` based on the `isActive` state.
-   **`private void OnDrawGizmos()`**
    -   Draws a gizmo in the editor to visualize the zone's collider boundaries, even when the GameObject is not selected. Helps with level design and placement.

**Dependencies:**

-   `SeedController.cs` (specifically, GameObjects with this script and tagged "Seed").
-   A `SpriteRenderer` component on the same GameObject for visual feedback.
-   A 2D Collider component (e.g., `BoxCollider2D`, `CircleCollider2D`) on the same GameObject, configured as a trigger.

---
