# Cosmic Harmonics - Script Documentation

This document provides an overview of the C# scripts created for the "Cosmic Harmonics" project, detailing their purpose, public members, and key methods.

**Last Updated:** (YYYY-MM-DD) <--- _You update this_
**Current Phase:** Phase 1: Prototyping (MVP) - End of Day (Gravity Well Implemented)

---

## Table of Contents

1.  **Core Systems (`Assets/_Project/Scripts/Core/Input/`)**
    -   `InputManager.cs`
    -   `PlayerControls.cs` (Auto-generated by Input System)
2.  **Gameplay Systems (`Assets/_Project/Scripts/Gameplay/`)**
    -   `SeedController.cs`
    -   `GravityWell_Star.cs`

---

## 1. Core Systems

### 1.1. `InputManager.cs`

**File Path:** `Assets/_Project/Scripts/Core/Input/InputManager.cs`

**Purpose:**
Handles player input for flicking actions using Unity's new Input System. It detects mouse click-drag-release gestures, converts screen coordinates to world coordinates, and provides data about the flick (start position, end position, vector). It also currently holds temporary logic to directly launch a test seed.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** None (but it references `Camera.main`).

**Public Members:**

-   **`public static InputManager Instance { get; private set; }`**
    -   A static property for implementing the Singleton pattern, allowing global access to the `InputManager` instance.
-   **`public SeedController testSeedToLaunch;`**
    -   **TEMPORARY:** A public reference to a `SeedController` instance. This is assigned in the Inspector and used for directly launching a seed for prototyping purposes. This responsibility will likely move to a `LevelManager` or `SeedSpawner` later.
-   **`public Vector2 FlickStartPosition { get; private set; }`**
    -   The world-space coordinates where the flick gesture started (mouse button pressed).
-   **`public Vector2 FlickEndPosition { get; private set; }`**
    -   The world-space coordinates where the flick gesture ended (mouse button released).
-   **`public bool IsFlicking { get; private set; }`**
    -   A boolean flag indicating if a flick gesture is currently in progress (mouse button is held down after an initial press).
-   **`public event System.Action<Vector2> OnFlickStart;`**
    -   An event fired when a flick gesture begins.
    -   Parameter: `Vector2` - The world-space position where the flick started.
-   **`public event System.Action<Vector2, Vector2> OnFlickEnd;`**
    -   An event fired when a flick gesture completes.
    -   Parameters:
        -   `Vector2` - The world-space position where the flick started.
        -   `Vector2` - The world-space position where the flick ended.

**Key Methods:**

-   **`private void Awake()`**
    -   Implements the Singleton pattern logic.
    -   Initializes `_playerControls = new PlayerControls();` (the auto-generated input actions class).
    -   Caches `_mainCamera = Camera.main;`.
    -   Includes error handling for `_playerControls` initialization and `Camera.main` availability.
-   **`private void OnEnable()`**
    -   Enables the `Gameplay` action map from `_playerControls`.
    -   Subscribes `OnFlickPressStarted` and `OnFlickPressCanceled` methods to the `started` and `canceled` events of the `FlickPress` input action.
    -   Includes error handling.
-   **`private void OnDisable()`**
    -   Unsubscribes from the `FlickPress` input action events.
    -   Disables the `Gameplay` action map.
-   **`private void OnFlickPressStarted(InputAction.CallbackContext context)`**
    -   Callback method executed when the `FlickPress` action starts (e.g., left mouse button down).
    -   Sets `IsFlicking = true`.
    -   Records `FlickStartPosition` using `GetPointerPositionInWorld()`.
    -   Invokes the `OnFlickStart` event.
-   **`private void OnFlickPressCanceled(InputAction.CallbackContext context)`**
    -   Callback method executed when the `FlickPress` action is canceled (e.g., left mouse button released).
    -   Sets `IsFlicking = false`.
    -   Records `FlickEndPosition`.
    -   Invokes the `OnFlickEnd` event.
    -   Calculates the `flickVector`.
    -   **TEMPORARY:** Contains logic to find `testSeedToLaunch`, set its position, reset it, and call its `Launch()` method.
-   **`public Vector2 GetPointerPositionInWorld()`**
    -   Reads the current pointer (mouse) screen position from `_playerControls.Gameplay.PointerPosition`.
    -   Converts the screen position to world coordinates using `_mainCamera.ScreenToWorldPoint()`.
    -   Returns a `Vector2` representing the pointer's position in the 2D game world (Z is effectively discarded).
    -   Includes error handling for `_mainCamera` and `_playerControls` being null.

**Dependencies:**

-   `PlayerControls.cs` (auto-generated input class).
-   `SeedController.cs` (for the temporary `testSeedToLaunch` field).
-   A `Camera` tagged "MainCamera" in the scene.

---

### 1.2. `PlayerControls.cs` (Auto-generated)

**File Path:** `Assets/_Project/Scripts/Core/Input/PlayerControls.cs`

**Purpose:**
This script is auto-generated by Unity's Input System based on the `PlayerControls.inputactions` asset. It provides a C# interface to the defined Action Maps, Actions, and Bindings. **This script should NOT be manually edited**, as changes will be overwritten when the `.inputactions` asset is modified or reimported.

**Key Auto-generated Content:**

-   **`public InputActionAsset asset { get; }`**: Reference to the underlying `InputActionAsset`.
-   **`public PlayerControls()` (Constructor)**: Loads the input actions from a JSON definition embedded in the script. Initializes action maps and actions (e.g., `m_Gameplay`, `m_Gameplay_FlickPress`, `m_Gameplay_PointerPosition`).
-   **`public void Dispose()`**: Disposes of the `InputActionAsset`.
-   **`public void Enable()` / `public void Disable()`**: Enables/disables all actions in the asset.
-   **`public GameplayActions @Gameplay { get; }`**: A property providing access to the `GameplayActions` struct.
-   **`public struct GameplayActions`**:
    -   Provides direct access to actions within the "Gameplay" map (e.g., `public InputAction @FlickPress`, `public InputAction @PointerPosition`).
    -   Contains methods to `Enable()`, `Disable()` the action map, and `AddCallbacks()`, `RemoveCallbacks()`, `SetCallbacks()` for an `IGameplayActions` interface.
-   **`public interface IGameplayActions`**:
    -   An interface that can be implemented by other scripts to receive callbacks for actions in the "Gameplay" map (e.g., `void OnFlickPress(InputAction.CallbackContext context);`). `InputManager.cs` uses direct C# event subscription (`+=`) instead of implementing this interface.

**Defined Actions (via `.inputactions` asset):**

-   **Action Map: `Gameplay`**
    -   **Action: `FlickPress`**
        -   Type: `Button`
        -   Binding: `Mouse / LeftButton`
    -   **Action: `PointerPosition`**
        -   Type: `Value`
        -   Control Type: `Vector2`
        -   Binding: `Mouse / position`

---

## 2. Gameplay Systems

### 2.1. `SeedController.cs`

**File Path:** `Assets/_Project/Scripts/Gameplay/SeedController.cs`

**Purpose:**
Manages the behavior of an individual "celestial seed." This includes its physics interactions, launch mechanics, and state.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** `Rigidbody2D`, `CircleCollider2D` (enforced by `[RequireComponent]` attributes).

**Public Members:**

-   **`public float launchForceMultiplier = 10f;`**
    -   A multiplier applied to the flick vector to determine the final launch force. Adjustable in the Inspector to tune the "feel" of the flick.

**Key Methods:**

-   **`private void Awake()`**
    -   Caches the attached `Rigidbody2D` component.
-   **`public void Launch(Vector2 flickVector)`**
    -   Applies a launch force to the seed.
    -   Parameters:
        -   `flickVector`: A `Vector2` representing the direction and raw magnitude of the flick (typically `FlickEndPosition - FlickStartPosition` from `InputManager`).
    -   Ensures the seed is only launched once by checking the `_isLaunched` flag.
    -   Sets `rb.bodyType = RigidbodyType2D.Dynamic` if it was previously `Kinematic`.
    -   Applies force using `rb.AddForce(flickVector * launchForceMultiplier, ForceMode2D.Impulse)`.
    -   Sets `_isLaunched = true`.
-   **`public void ResetSeed(Vector2 startPosition)`**
    -   Resets the seed to an initial state, typically before a new launch.
    -   Parameters:
        -   `startPosition`: The `Vector2` world position where the seed should be placed.
    -   Sets `rb.linearVelocity` and `rb.angularVelocity` to zero.
    -   Updates the `transform.position` to `startPosition`.
    -   Resets `_isLaunched = false`.

**Dependencies:**

-   `InputManager.cs` (or another system) to call `Launch()` and `ResetSeed()`.

---

### 2.2. `GravityWell_Star.cs`

**File Path:** `Assets/_Project/Scripts/Gameplay/GravityWell_Star.cs`

**Purpose:**
Defines the behavior of a fixed "Star" gravity well. It exerts a radial gravitational pull on any GameObjects tagged "Seed" that enter its defined effect radius.

**Inheritance:** `MonoBehaviour`

**Key Components Required on GameObject:** `CircleCollider2D` (enforced by `[RequireComponent]` attribute). This collider should be set as a Trigger.

**Public Members:**

-   **`public float gravityStrength = 50f;`**
    -   The magnitude of the gravitational force applied by the star. Adjustable in the Inspector.
-   **`public float effectRadius = 5f;`**
    -   The radius within which the star's gravity affects seeds. This value is used to set the `CircleCollider2D`'s radius. Adjustable in the Inspector.

**Private Serialized Members (Visible in Inspector for Debugging):**

-   **`private List<Rigidbody2D> affectedRigidbodies`**
    -   A list that stores references to the `Rigidbody2D` components of seeds currently within the star's gravitational influence (i.e., within its trigger collider).

**Key Methods:**

-   **`private void Awake()`**
    -   Caches the attached `CircleCollider2D` component (`_effectCollider`).
    -   Ensures `_effectCollider.isTrigger` is set to `true`.
    -   Synchronizes `_effectCollider.radius` with the public `effectRadius` property.
-   **`private void FixedUpdate()`**
    -   This method is called every fixed physics timestep.
    -   Iterates through the `affectedRigidbodies` list.
    -   For each `Rigidbody2D` in the list (and ensuring it's not null and its GameObject is active):
        -   Calculates the normalized direction vector from the seed towards the star's center.
        -   Applies a gravitational force to the seed's rigidbody using `rb.AddForce(directionToWell * gravityStrength, ForceMode2D.Force)`.
    -   Includes logic to remove null entries from `affectedRigidbodies` (if a seed was destroyed).
-   **`private void OnTriggerEnter2D(Collider2D other)`**
    -   Called when another collider enters this GameObject's trigger collider.
    -   Checks if the `other` GameObject is tagged "Seed".
    -   If it is a "Seed" and has a `Rigidbody2D`, and is not already in `affectedRigidbodies`, it's added to the list.
-   **`private void OnTriggerExit2D(Collider2D other)`**
    -   Called when another collider exits this GameObject's trigger collider.
    -   Checks if the `other` GameObject is tagged "Seed".
    -   If it is, its `Rigidbody2D` is removed from the `affectedRigidbodies` list.
-   **`private void OnDrawGizmosSelected()`**
    -   Called by Unity to draw gizmos in the editor when the GameObject is selected.
    -   Draws a yellow wire sphere and a semi-transparent filled sphere representing the `effectRadius`.
-   **`private void OnValidate()`**
    -   Called in the editor when the script is loaded or a value is changed in the Inspector.
    -   Attempts to synchronize the `_effectCollider.radius` with the `effectRadius` property, primarily for changes made outside of play mode.

**Dependencies:**

-   `SeedController.cs` (specifically, GameObjects with this script, tagged "Seed", and having a `Rigidbody2D`).

---
