# Cosmic Harmonics - Implementation Log

**Last Updated:** (2025-06-02) <--- _You can update this date as you work_
**Current Blueprint Phase:** Phase 1: Prototyping (MVP)
**Current Focus:** Project Setup & Initial Scene Configuration

---

## Phase 1: Prototyping (MVP) - Initial Setup

### 1. Unity Project Creation & Configuration

-   **Unity Version:** 2022.3.x LTS (or latest stable LTS at time of creation)
-   **Project Template:** 2D (URP)
    -   _If 2D (URP) template wasn't used, URP was installed manually via Package Manager._
-   **Render Pipeline:** Universal Render Pipeline (URP)
    -   Created URP Asset (e.g., `CosmicHarmonics_URPAsset`) with a 2D Renderer.
    -   Assigned URP Asset in `Project Settings > Graphics`.
    -   Assigned URP Asset in `Project Settings > Quality` for all quality levels.
-   **Target Platform (Initial Focus):** PC (Windows, macOS, Linux)

### 2. Version Control (Git & LFS)

-   **Git Repository:** Initialized in the project root directory.
-   **`.gitignore` File:** Created in the project root with Unity-specific and IDE-specific ignores as per blueprint.
-   **Git LFS (Large File Storage):**
    -   Installed and initialized (`git lfs install`).
    -   Tracked file types:
        -   `*.png`, `*.jpg`, `*.jpeg`, `*.gif`
        -   `*.psd`
        -   `*.ogg`, `*.wav`, `*.mp3`
        -   `*.asset`
    -   `.gitattributes` file created/updated.
-   **Branching Strategy:**
    -   `main` branch: For stable, releasable states.
    -   `develop` branch: Created and checked out for ongoing development.
-   **Initial Commits:**
    1.  `Initial commit: Setup .gitignore and Git LFS`
    2.  `feat: Initial Unity project structure` (covering Assets/, ProjectSettings/, Packages/)

### 3. Project Folder Structure (within `Assets/`)

-   Created main project folder: `_Project`
-   **Subfolders within `Assets/_Project/`:**
    -   `Animations`
    -   `Audio`
        -   `Music`
        -   `SFX`
    -   `Fonts`
    -   `Materials`
    -   `Prefabs`
        -   `Characters`
        -   `Environment`
        -   `FX`
        -   `UI`
    -   `Scenes`
        -   `_Main`
        -   `_Levels`
    -   `ScriptableObjects`
        -   `Levels`
        -   `SeedTypes`
        -   `EventChannels`
    -   `Scripts`
        -   `Core`
        -   `Gameplay`
        -   `Editor`
        -   `UI`
    -   `Shaders`
    -   `Sprites` (or `Textures`)
        -   `UI`
        -   `Gameplay`

### 4. Initial Scene Setup & Camera Configuration

-   **Scene Created:** `MainGameplay_Prototype.unity` (or similar, e.g., `Level_00_Sandbox.unity`)
-   **Scene Location:** Saved in `Assets/_Project/Scenes/_Main/` (or `_Levels/`)
-   **Main Camera (`Main Camera` GameObject):**
    -   **Transform:**
        -   Position: `(X: 0, Y: 0, Z: -10)`
    -   **Camera Component:**
        -   Projection: `Orthographic`
        -   Size: `5` (initial value, adaptable)
        -   Clipping Planes: Near `0.3`, Far `1000`
        -   Rendering > Renderer: Linked to URP's 2D Renderer.
        -   Environment > Background Type: `Solid Color`
        -   Background Color: Set to a dark cosmic theme (e.g., R:20, G:20, B:40 or R:10, G:5, B:15).
        -   Post Processing: Checkbox **enabled**.
-   **Scene Hierarchy Organization (Initial Empty GameObjects):**
    -   `// -- MANAGERS --`
    -   `// -- ENVIRONMENT --`
    -   `// -- DYNAMIC_OBJECTS --`
    -   `// -- UI --`

### 5. Save & Commit Progress

-   Project and Scene saved.
-   **Git Commit:** `feat: Initial project and scene setup with URP camera`
-   Changes pushed to `develop` branch on remote repository (if applicable).

---

---

### 6. Input System Setup (New Unity Input System)

-   **Package Installation:**
    -   Installed "Input System" package (version 1.x.x - _you can check the exact version in Package Manager if desired_) via Package Manager.
    -   Project active input handling set to "Input System Package (New)" in `Edit > Project Settings > Player > Other Settings` (Unity restarted).
-   **Input Actions Asset:**
    -   Created `PlayerControls.inputactions` asset in `Assets/_Project/Scripts/Core/Input/`.
    -   The associated C# class `PlayerControls.cs` was generated by Unity in the same folder (`Assets/_Project/Scripts/Core/Input/PlayerControls.cs`).
    -   **Action Map:** `Gameplay`
        -   **Action:** `FlickPress`
            -   Type: `Button`
            -   Binding: `Mouse / LeftButton`
        -   **Action:** `PointerPosition`
            -   Type: `Value`
            -   Control Type: `Vector2`
            -   Binding: `Mouse / position`
    -   Saved asset and ensured "Generate C# Class" was checked in Inspector, then clicked "Apply".
-   **`InputManager.cs` Script:**
    -   Created `InputManager.cs` in `Assets/_Project/Scripts/Core/Input/`
    -   Implemented Singleton pattern for easy access (`InputManager.Instance`).
    -   Cached `Camera.main` in `Awake()`.
    -   Instantiated `PlayerControls` in `Awake()`.
    -   Subscribed to `_playerControls.Gameplay.FlickPress.started` and `_playerControls.Gameplay.FlickPress.canceled` events in `OnEnable()`, unsubscribed in `OnDisable()`.
    -   `OnFlickPressStarted(InputAction.CallbackContext context)`:
        -   Sets `IsFlicking = true`.
        -   Records `FlickStartPosition` (world coordinates) using `GetPointerPositionInWorld()`.
        -   Invokes `OnFlickStart` event (optional, but good for future decoupling).
        -   Logs flick start screen and world positions.
    -   `OnFlickPressCanceled(InputAction.CallbackContext context)`:
        -   Sets `IsFlicking = false` if it was true.
        -   Records `FlickEndPosition` (world coordinates).
        -   Invokes `OnFlickEnd` event.
        -   Logs flick end screen and world positions, and the calculated flick vector in world coordinates.
    -   `GetPointerPositionInWorld()`:
        -   Reads screen position from `_playerControls.Gameplay.PointerPosition.ReadValue<Vector2>()`.
        -   Converts to world coordinates using `_mainCamera.ScreenToWorldPoint()`.
        -   Returns a `Vector2` (x, y) for 2D gameplay.
-   **Scene Integration:**
    -   Created an empty GameObject named `InputManager` (typically under `// -- MANAGERS --` in the scene hierarchy).
    -   Attached `InputManager.cs` script to this GameObject.
-   **Testing & Verification:**
    -   Confirmed in Play mode via Console logs that:
        -   `FlickPress.started` triggers `OnFlickPressStarted` on mouse button down.
        -   `FlickPress.canceled` triggers `OnFlickPressCanceled` on mouse button release.
        -   Screen and World coordinates for flick start/end are logged correctly.
        -   A non-zero flick vector (World) is calculated and logged.

---

---

### 7. Basic Seed Implementation

-   **Sprite Creation:**
    -   Used a built-in Unity 2D Sprite (`Circle`) named `Seed_Circle_Sprite` located in `Assets/_Project/Sprites/Gameplay/`.
    -   Sprite configured with default `Pixels Per Unit` (e.g., 100).
-   **Seed GameObject (`Seed_Prototype`):**
    -   Created a 2D Sprite GameObject in the scene named `Seed_Prototype`.
    -   Assigned the `Seed_Circle_Sprite` to its `Sprite Renderer` component.
    -   Initial Transform: Position `(0,0,0)`, Scale `(1,1,1)`.
-   **Physics Components on `Seed_Prototype`:**
    -   **`Rigidbody 2D`:**
        -   Body Type: `Dynamic`
        -   Collision Detection: `Discrete` (initially)
        -   Constraints: `Freeze Rotation Z` enabled.
        -   Global Gravity (Project Settings > Physics 2D > Gravity Y) set to `0` for cosmic feel.
    -   **`Circle Collider 2D`:**
        -   Is Trigger: `false`
        -   Radius adjusted to match sprite visuals.
-   **`SeedController.cs` Script:**
    -   Created `SeedController.cs` in `Assets/_Project/Scripts/Gameplay/`.
    -   Attached to `Seed_Prototype` GameObject.
    -   `[RequireComponent(typeof(Rigidbody2D), typeof(CircleCollider2D))]` attributes added.
    -   `Awake()`: Caches `Rigidbody2D`.
    -   `launchForceMultiplier`: Public float to adjust flick strength (default e.g., 10f).
    -   `Launch(Vector2 flickVector)`:
        -   Checks `_isLaunched` flag to prevent multiple launches.
        -   Sets `rb.bodyType = RigidbodyType2D.Dynamic` if it was `Kinematic`.
        -   Applies `flickVector * launchForceMultiplier` using `rb.AddForce(..., ForceMode2D.Impulse)`.
        -   Sets `_isLaunched = true`.
        -   Logs launch details.
    -   `ResetSeed(Vector2 startPosition)`:
        -   Sets `rb.linearVelocity` and `rb.angularVelocity` to zero.
        -   Updates `transform.position`.
        -   Resets `_isLaunched = false`.
        -   Logs reset action.
-   **Temporary Integration with `InputManager.cs` for Testing:**
    -   Added `public SeedController testSeedToLaunch;` field to `InputManager`.
    -   In `InputManager.OnFlickPressCanceled()`:
        -   Calculated `flickVector`.
        -   If `testSeedToLaunch` is assigned:
            -   Set `testSeedToLaunch.transform.position = FlickStartPosition`.
            -   Called `testSeedToLaunch.ResetSeed(FlickStartPosition)`.
            -   Called `testSeedToLaunch.Launch(flickVector)`.
    -   Assigned the `Seed_Prototype` instance from the scene to the `Test Seed To Launch` slot on the `InputManager` GameObject in the Inspector.
-   **Prefab Creation:**
    -   Created a prefab from `Seed_Prototype` by dragging it into `Assets/_Project/Prefabs/Characters/`.
    -   The instance in the scene (`Seed_Prototype`) was kept for direct testing with `InputManager`.
-   **Testing & Verification:**
    -   Confirmed in Play mode:
        -   The `Seed_Prototype` GameObject is launched when the mouse is flicked.
        -   The direction and force of the launch correspond to the flick gesture.
        -   The seed moves according to 2D physics and does not fall due to global gravity (Y=0).
        -   Repeated flicks correctly reset and relaunch the seed from the new flick start position.
        -   The `isKinematic` obsolete warning was resolved by using `rb.bodyType`.
        -   Previous `NullReferenceException`s in `InputManager` were resolved, and `_playerControls` initializes and functions correctly.

---
